name: Copy Code by Commit ID

on:
  workflow_dispatch:
    inputs:
      commit_id:
        required: true
        description: 'Commit ID to use for copying'

jobs:
  copy:
    runs-on: ubuntu-latest

    steps:
    - name: Use Entered Commit ID
      id: commit_id_input
      run: |
        COMMIT_ID="${{ github.event.inputs.commit_id }}"
        echo "Using Commit ID: $COMMIT_ID"

    - name: Archive code at Commit ID
      run: |
        COMMIT_ID="${{ steps.commit_id_input.outputs.COMMIT_ID }}"
        git archive --format=tar.gz --output=code.tar.gz $COMMIT_ID

    - name: Extract code
      run: |
        tar xvzf code.tar.gz
        rm code.tar.gz

    - name: Copy code to GCS bucket
      run: |
        gsutil -m cp -r . gs://testmmf/$COMMIT_ID/
